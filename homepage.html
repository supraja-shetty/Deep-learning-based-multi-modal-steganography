<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Steganography Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(120deg, #74ebd5, #ACB6E5);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .card {
      border-radius: 20px;
      box-shadow: 0px 6px 15px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }
    .btn-custom {
      border-radius: 25px;
      padding: 10px 20px;
      font-weight: bold;
    }
    h2 {
      font-weight: bold;
      color: #2c3e50;
    }
    .result-box {
      background: #f8f9fa;
      border-left: 5px solid #2c3e50;
      padding: 15px;
      margin-top: 15px;
      border-radius: 10px;
    }
    img, video, audio {
      max-width: 100%;
      height: auto;
      border-radius: 15px;
      box-shadow: 0px 4px 10px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>
<div class="container py-5">
  <h1 class="text-center mb-4 text-white">DEEP LEARNING BASED MULTI MODAL STEGANOGRAPHY</h1>

  <!-- ================= TEXT STEGANOGRAPHY ================= -->
  <div class="card p-4">
    <h2>TEXT STEGANOGRAPHY</h2>
    <form method="POST" action="/hide_text">
      <div class="row g-2">
        <div class="col-md-4">
          <input type="text" name="secret_msg" class="form-control" placeholder="Secret message" required />
        </div>
        <div class="col-md-4">
          <input type="password" name="password" class="form-control" placeholder="Password" required />
        </div>
        <div class="col-md-3">
          <input type="text" name="cover_msg" class="form-control" placeholder="Cover message" required />
        </div>
        <div class="col-md-1 d-grid">
          <button type="submit" class="btn btn-success btn-custom">Hide â¡</button>
        </div>
      </div>
    </form>
    {% if stego_msg %}
    <div class="result-box">
      <strong>âœ… Stego Message:</strong>
      <p>{{ stego_msg }}</p>
      <button type="button" class="btn btn-outline-success btn-sm send-btn" data-text="{{ stego_msg|e }}">ğŸ“¤ Send</button>
      <a href="/receive" class="btn btn-outline-primary btn-sm receive-btn">ğŸ“¥ Receive</a>
    </div>
    {% endif %}
  </div>

  <div class="card p-4">
    <h2>Reveal Text</h2>
    <form method="POST" action="/reveal_text">
      <div class="row g-2">
        <div class="col-md-4">
          <input type="password" name="password" class="form-control" placeholder="Password" required />
        </div>
        <div class="col-md-6">
          <input type="text" name="stego_msg" value="{{ stego_msg or '' }}" class="form-control" placeholder="Stego message" required />
        </div>
        <div class="col-md-2 d-grid">
          <button type="submit" class="btn btn-primary btn-custom">Reveal â¡</button>
        </div>
      </div>
    </form>
    {% if revealed_msg %}
    <div class="result-box">
      <strong>ğŸ”“ Revealed Message:</strong>
      <p>{{ revealed_msg }}</p>
      <button type="button" class="btn btn-outline-success btn-sm send-btn" data-text="{{ revealed_msg|e }}">ğŸ“¤ Send</button>
      <a href="/receive" class="btn btn-outline-primary btn-sm receive-btn">ğŸ“¥ Receive</a>
    </div>
    {% endif %}
  </div>

  <!-- ================= IMAGE STEGANOGRAPHY ================= -->
  <div class="card p-4">
    <h2>IMAGE STEGANOGRAPHY</h2>
    <form method="POST" action="/hide_image" enctype="multipart/form-data">
      <div class="row g-2">
        <label for="secret_video" class="form-label fw-bold">Cover Image</label>
        <div class="col-md-4"><input type="file" name="cover_img" class="form-control" required /></div>
        <label for="secret_video" class="form-label fw-bold">Secret Image</label>
        <div class="col-md-4"><input type="file" name="secret_img" class="form-control" required /></div>
        <div class="col-md-3"><input type="password" name="password" class="form-control" placeholder="Password" required /></div>
        <div class="col-md-1 d-grid"><button type="submit" class="btn btn-warning btn-custom">Hide â¡</button></div>
      </div>
    </form>
    {% if result_image %}
    <div class="result-box text-center mt-3">
      <strong>âœ… Stego Image:</strong><br />
      <img src="{{ url_for('static', filename=result_image) }}" alt="Stego Image" /><br />
      <a href="{{ url_for('static', filename=result_image) }}" download class="btn btn-outline-primary mt-2">â¬‡ Download</a>
      <button type="button" class="btn btn-outline-success btn-sm send-btn" data-filename="{{ result_image }}">ğŸ“¤ Send</button>
      <a href="/receive" class="btn btn-outline-primary btn-sm receive-btn">ğŸ“¥ Receive</a>
    </div>
    {% endif %}
  </div>

  <div class="card p-4">
    <h2>Reveal Image</h2>
    <form method="POST" action="/reveal_image" enctype="multipart/form-data">
      <div class="row g-2">
        <label for="secret_video" class="form-label fw-bold">Stego Image</label>
        <div class="col-md-8"><input type="file" name="stego_img" class="form-control" required /></div>
        <div class="col-md-4"><input type="password" name="password" class="form-control" placeholder="Password" required /></div>
        <div class="col-md-12 d-grid mt-2"><button type="submit" class="btn btn-danger btn-custom">Reveal â¡</button></div>
      </div>
    </form>
    {% if revealed_image %}
    <div class="result-box text-center mt-3">
      <strong>ğŸ”“ Revealed Secret Image:</strong><br />
      <img src="{{ url_for('static', filename=revealed_image) }}" alt="Revealed Secret" /><br />
      <a href="{{ url_for('static', filename=revealed_image) }}" download class="btn btn-outline-success mt-2">â¬‡ Download</a>
      <button type="button" class="btn btn-outline-warning btn-sm send-btn" data-filename="{{ revealed_image }}">ğŸ“¤ Send</button>
      <a href="/receive" class="btn btn-outline-primary btn-sm receive-btn">ğŸ“¥ Receive</a>
    </div>
    {% endif %}
  </div>

  <!-- ================= VIDEO STEGANOGRAPHY ================= -->
  <div class="card p-4">
    <h2>VIDEO STEGANOGRAPHY</h2>
    <form method="POST" action="/hide_video" enctype="multipart/form-data">
      <div class="row g-2">
        <label for="cover_video" class="form-label fw-bold">cover vedio</label>
        <div class="col-md-6"><input type="file" name="cover_video" class="form-control" required /></div>
        <label for="secret_video" class="form-label fw-bold">Secret Video</label>
        <div class="col-md-6"><input type="file" name="secret_video" class="form-control" required /></div>
      </div>
      <div class="mt-2"><input type="password" name="password" class="form-control" placeholder="Password" required /></div>
      <div class="d-grid mt-3"><button type="submit" class="btn btn-dark btn-custom">Hide Video â¡</button></div>
    </form>
    {% if result_video %}
    <div class="result-box text-center mt-3">
      <strong>âœ… Stego Video:</strong><br />
      <video controls width="480"><source src="{{ url_for('static', filename=result_video) }}" type="video/mp4" /></video><br />
      <a href="{{ url_for('static', filename=result_video) }}" download class="btn btn-outline-primary mt-2">â¬‡ Download</a>
      <button type="button" class="btn btn-outline-success btn-sm send-btn" data-filename="{{ result_video }}">ğŸ“¤ Send</button>
      <a href="/receive" class="btn btn-outline-primary btn-sm receive-btn">ğŸ“¥ Receive</a>
    </div>
    {% endif %}
  </div>

  <div class="card p-4">
    <h2>Reveal from Video</h2>
    <form method="POST" action="/reveal_video" enctype="multipart/form-data">
      <div class="row g-2">
        <label for="secret_video" class="form-label fw-bold">stego vedio</label>
        <div class="col-md-6"><input type="file" name="stego_video" class="form-control" required /></div>
        <div class="col-md-6"><input type="password" name="password" class="form-control" placeholder="Password" required /></div>
        <div class="col-md-12 d-grid mt-3"><button type="submit" class="btn btn-secondary btn-custom">Reveal â¡</button></div>
      </div>
    </form>
    {% if revealed_video %}
    <div class="result-box text-center mt-3">
      <strong>ğŸ”“ Revealed Secret Video:</strong><br />
      <video controls width="480"><source src="{{ url_for('static', filename=revealed_video) }}" type="video/mp4" /></video><br />
      <a href="{{ url_for('static', filename=revealed_video) }}" download class="btn btn-outline-success mt-2">â¬‡ Download</a>
      <button type="button" class="btn btn-outline-warning btn-sm send-btn" data-filename="{{ revealed_video }}">ğŸ“¤ Send</button>
      <a href="/receive" class="btn btn-outline-primary btn-sm receive-btn">ğŸ“¥ Receive</a>
    </div>
    {% endif %}
  </div>

  <!-- ================= AUDIO STEGANOGRAPHY ================= -->
  <div class="card p-4">
    <h2>AUDIO STEGANOGRAPHY</h2>
    <form method="POST" action="/hide_audio" enctype="multipart/form-data">
      <div class="row g-2">
        <label for="secret_video" class="form-label fw-bold">Cover Audio</label>
        <div class="col-md-6"><input type="file" name="cover_audio" class="form-control" required /></div>
        <label for="secret_video" class="form-label fw-bold">Secret Audio</label>
        <div class="col-md-6"><input type="file" name="secret_audio" class="form-control" required /></div>
      </div>
      <div class="mt-2"><input type="password" name="password" class="form-control" placeholder="Password" required /></div>
      <div class="d-grid mt-3"><button type="submit" class="btn btn-info btn-custom">Hide Audio â¡</button></div>
    </form>
    {% if result_audio %}
    <div class="result-box text-center mt-3">
      <strong>âœ… Stego Audio:</strong><br />
      <audio controls><source src="{{ url_for('static', filename=result_audio) }}" type="audio/wav" /></audio><br />
      <a href="{{ url_for('static', filename=result_audio) }}" download class="btn btn-outline-primary mt-2">â¬‡ Download</a>
      <button type="button" class="btn btn-outline-success btn-sm send-btn" data-filename="{{ result_audio }}">ğŸ“¤ Send</button>
      <a href="/receive" class="btn btn-outline-primary btn-sm receive-btn">ğŸ“¥ Receive</a>
    </div>
    {% endif %}
  </div>

  <div class="card p-4">
    <h2>Reveal Audio</h2>
    <form method="POST" action="/reveal_audio" enctype="multipart/form-data">
      <div class="row g-2">
        <label for="secret_video" class="form-label fw-bold">Stego Audio</label>
        <div class="col-md-8"><input type="file" name="stego_audio" class="form-control" required /></div>
        <div class="col-md-4"><input type="password" name="password" class="form-control" placeholder="Password" required /></div>
        <div class="col-md-12 d-grid mt-2"><button type="submit" class="btn btn-warning btn-custom">Reveal â¡</button></div>
      </div>
    </form>
    {% if revealed_audio %}
    <div class="result-box text-center mt-3">
      <strong>ğŸ”“ Revealed Secret Audio:</strong><br />
      <audio controls><source src="{{ url_for('static', filename=revealed_audio) }}" type="audio/wav" /></audio><br />
      <a href="{{ url_for('static', filename=revealed_audio) }}" download class="btn btn-outline-success mt-2">â¬‡ Download</a>
      <button type="button" class="btn btn-outline-warning btn-sm send-btn" data-filename="{{ revealed_audio }}">ğŸ“¤ Send</button>
      <a href="/receive" class="btn btn-outline-primary btn-sm receive-btn">ğŸ“¥ Receive</a>
    </div>
    {% endif %}
  </div>

  <!-- ================= REAL-TIME RECEIVE LIST ================= -->
  <h3 class="mt-4 text-white">Received Files (Real-time)</h3>
  <div id="received-list" class="row g-3"></div>

</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
// ===== Real-time updates =====
const socket = io();
socket.on('connect', () => console.log("âœ… Connected for real-time updates"));

socket.on('new_file', data => {
    alert("ğŸ“¥ New file received: " + data.filename);
    const list = document.getElementById('received-list');
    if (!list) return;

    const col = document.createElement('div');
    col.className = 'col-md-4';
    const card = document.createElement('div');
    card.className = 'card p-3 result-box text-center';
    const strong = document.createElement('strong');
    strong.textContent = "ğŸ“¥ Received: " + data.filename;
    card.appendChild(strong);
    card.appendChild(document.createElement('br'));

    const ext = data.filename.split('.').pop().toLowerCase();
    let preview;
    if(['png','jpg','jpeg','gif'].includes(ext)){
        preview = document.createElement('img');
        preview.src = `/static/send_${data.filename}`;
    } else if(['mp4','webm','ogg'].includes(ext)){
        preview = document.createElement('video');
        preview.controls = true;
        const source = document.createElement('source');
        source.src = `/static/send_${data.filename}`;
        source.type = 'video/mp4';
        preview.appendChild(source);
    } else if(['wav','mp3','ogg'].includes(ext)){
        preview = document.createElement('audio');
        preview.controls = true;
        const source = document.createElement('source');
        source.src = `/static/send_${data.filename}`;
        source.type = 'audio/wav';
        preview.appendChild(source);
    } else {
        preview = document.createElement('p');
        preview.textContent = "ğŸ“„ " + data.filename;
    }
    preview.style.maxWidth = '100%';
    preview.style.marginTop = '10px';
    card.appendChild(preview);

    const downloadBtn = document.createElement('a');
    downloadBtn.href = `/static/send_${data.filename}`;
    downloadBtn.target = "_blank";
    downloadBtn.className = "btn btn-outline-primary btn-sm mt-2";
    downloadBtn.textContent = "â¬‡ Download";
    card.appendChild(downloadBtn);

    const sendBtn = document.createElement('button');
    sendBtn.className = "btn btn-outline-success btn-sm mt-2 ms-2 send-btn";
    sendBtn.textContent = "ğŸ“¤ Send";
    sendBtn.dataset.filename = data.filename;
    sendBtn.addEventListener('click', () => {
        let formData = new FormData();
        fetch(`/static/send_${data.filename}`)
            .then(res => res.blob())
            .then(blob => {
                let file = new File([blob], data.filename);
                formData.append("file", file);
                return fetch("/send", { method:"POST", body: formData });
            })
            .then(res => res.text())
            .then(html => {
                alert("ğŸ“¤ File sent successfully!");
                document.body.innerHTML = html;
            })
            .catch(err => {
                console.error(err);
                alert("âŒ Error sending file");
            });
    });
    card.appendChild(sendBtn);
    col.appendChild(card);
    list.appendChild(col);
});

// ===== Send buttons for result-boxes =====
document.querySelectorAll('.send-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        let formData = new FormData();
        if (btn.dataset.filename) {
            fetch(`/static/${btn.dataset.filename}`)
                .then(res => res.blob())
                .then(blob => {
                    let file = new File([blob], btn.dataset.filename);
                    formData.append("file", file);
                    return fetch("/send", { method:"POST", body: formData });
                })
                .then(res => res.text())
                .then(html => {
                    alert("ğŸ“¤ File sent successfully!");
                    document.body.innerHTML = html;
                })
                .catch(err => {
                    console.error(err);
                    alert("âŒ Error sending file");
                });
        } else if (btn.dataset.text) {
            const card = btn.closest('.card');
            const passwordInput = card.querySelector('input[name="password"]');
            const password = passwordInput ? passwordInput.value : "";
            const textData = btn.dataset.text;
            const fileData = `${password}\n${textData}`;
            let file = new File([fileData], "message.txt", { type: "text/plain" });
            formData.append("file", file);
            fetch("/send", { method:"POST", body: formData })
              .then(res => res.text())
              .then(html => {
                  alert("ğŸ“¤ Text sent successfully!");
                  document.body.innerHTML = html;
              })
              .catch(err => {
                  console.error(err);
                  alert("âŒ Error sending text");
              });
        }
    });
});
</script>
</body>
</html>
